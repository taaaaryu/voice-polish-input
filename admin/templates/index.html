<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>VoicePolishInput Admin</title>
  <style>
    :root { color-scheme: light dark; }
    body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    main { max-width: 1100px; margin: 0 auto; padding: 24px; }
    h1, h2 { margin: 0 0 12px; }
    .sub { margin: 0 0 20px; color: #666; font-size: 13px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .card { border: 1px solid #d0d0d0; border-radius: 10px; padding: 14px; }
    .row { display: flex; gap: 8px; align-items: center; margin-bottom: 8px; }
    input[type="text"] { padding: 6px 8px; border-radius: 6px; border: 1px solid #b9b9b9; min-width: 120px; }
    button { padding: 6px 10px; border-radius: 6px; border: 1px solid #888; background: transparent; cursor: pointer; }
    ul { margin: 8px 0 0; padding: 0; list-style: none; }
    li { display: flex; align-items: center; justify-content: space-between; border-top: 1px solid #ececec; padding: 6px 0; }
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    th, td { border-top: 1px solid #ececec; text-align: left; vertical-align: top; padding: 8px 6px; }
    th { font-weight: 600; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; white-space: pre-wrap; word-break: break-word; }
    @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <main>
    <h1>VoicePolishInput Admin</h1>
    <p class="sub">State file: <span class="mono">{{ state_path }}</span></p>

    <div class="grid">
      <section class="card">
        <h2>Filler Words</h2>
        <form class="row" action="/fillers/add" method="post">
          <input type="text" name="word" placeholder="word to remove">
          <button type="submit">Add</button>
        </form>
        <ul>
          {% for word in fillers %}
          <li>
            <span>{{ word }}</span>
            <form action="/fillers/delete" method="post">
              <input type="hidden" name="word" value="{{ word }}">
              <button type="submit">Delete</button>
            </form>
          </li>
          {% endfor %}
          {% if fillers|length == 0 %}
          <li><span>No entries</span></li>
          {% endif %}
        </ul>
      </section>

      <section class="card">
        <h2>User Dictionary</h2>
        <form class="row" action="/replacements/upsert" method="post">
          <input type="text" name="src" placeholder="from">
          <input type="text" name="dst" placeholder="to">
          <button type="submit">Save</button>
        </form>
        <ul>
          {% for item in replacements %}
          <li>
            <span>{{ item["from"] }} â†’ {{ item["to"] }}</span>
            <form action="/replacements/delete" method="post">
              <input type="hidden" name="src" value="{{ item['from'] }}">
              <button type="submit">Delete</button>
            </form>
          </li>
          {% endfor %}
          {% if replacements|length == 0 %}
          <li><span>No entries</span></li>
          {% endif %}
        </ul>
      </section>
    </div>

    <section class="card" style="margin-top: 16px;">
      <div class="row" style="justify-content: space-between;">
        <h2>Speech History (latest {{ history|length }} / total {{ history_count }})</h2>
        <form action="/history/clear" method="post">
          <button type="submit">Clear History</button>
        </form>
      </div>
      <table>
        <thead>
          <tr>
            <th style="width: 160px;">Time</th>
            <th style="width: 70px;">Inserted</th>
            <th>Raw</th>
            <th>Polished</th>
            <th>Error</th>
          </tr>
        </thead>
        <tbody>
          {% for item in history %}
          <tr>
            <td class="mono">{{ item["createdAtISO8601"] }}</td>
            <td>{{ "yes" if item["inserted"] else "no" }}</td>
            <td class="mono">{{ item["rawText"] }}</td>
            <td class="mono">{{ item["polishedText"] }}</td>
            <td class="mono">{{ item["errorMessage"] or "" }}</td>
          </tr>
          {% endfor %}
          {% if history|length == 0 %}
          <tr><td colspan="5">No history yet.</td></tr>
          {% endif %}
        </tbody>
      </table>
    </section>
  </main>
</body>
</html>

